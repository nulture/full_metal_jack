[gd_scene load_steps=27 format=3 uid="uid://brbm7ub2jbg4p"]

[ext_resource type="PackedScene" uid="uid://cgmfug0eq3en1" path="res://assets/scenes/enemies/enemy.tscn" id="1_sf727"]
[ext_resource type="PackedScene" uid="uid://6d5gqqfyogj6" path="res://assets/models/wesley/wesley.glb" id="2_4rdvv"]
[ext_resource type="PackedScene" uid="uid://boyloil5dmnft" path="res://assets/scenes/pickups/pickup_carbine.tscn" id="2_citca"]
[ext_resource type="Material" uid="uid://dbicob5d8wu5w" path="res://assets/models/wesley/wesley_material.tres" id="3_r16x8"]
[ext_resource type="PackedScene" uid="uid://m3g6mj32wfve" path="res://assets/scenes/weapon_config/weapon_config_wesley.tscn" id="4_05i2f"]
[ext_resource type="Script" path="res://assets/scripts/brains/brain_wesley.gd" id="4_i2k7d"]
[ext_resource type="Script" path="res://assets/scripts/root_motion.gd" id="4_xrh1b"]
[ext_resource type="AudioStream" uid="uid://ds2iofdu4ho74" path="res://assets/audio/robotic_lycan_howl_01.ogg" id="5_af5m6"]

[sub_resource type="BoxShape3D" id="BoxShape3D_p0n00"]
size = Vector3(0.780273, 2, 0.674072)

[sub_resource type="QuadMesh" id="QuadMesh_bdlb5"]
size = Vector2(0.025, 50)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_lbsu1"]
transparency = 1
blend_mode = 1
depth_draw_mode = 1
albedo_color = Color(0.333333, 1, 0, 1)

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_xawel"]
animation = &"dropin"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_rk8ir"]
animation = &"fire"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_01kr1"]
animation = &"howl"
use_custom_timeline = true
timeline_length = 5.0
stretch_time_scale = true
start_offset = 0.0
loop_mode = 0

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_xd33j"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ht6xd"]
animation = &"ready_aim"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_vd2uf"]
animation = &"run"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_q6eal"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_6v802"]
xfade_time = 0.25
advance_mode = 2
advance_expression = "is_walking"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_herc0"]
xfade_time = 0.25
advance_mode = 2
advance_expression = "not is_walking"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_jdvk7"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_w485l"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_qxgsg"]
xfade_time = 0.1
advance_mode = 2
advance_expression = "state == 2"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_7uv1i"]
advance_mode = 2
advance_expression = "state == 3"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_qo77p"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_8rvsn"]
states/dropin/node = SubResource("AnimationNodeAnimation_xawel")
states/dropin/position = Vector2(346.333, 99.8889)
states/fire/node = SubResource("AnimationNodeAnimation_rk8ir")
states/fire/position = Vector2(670.444, 250.889)
states/howl/node = SubResource("AnimationNodeAnimation_01kr1")
states/howl/position = Vector2(516.556, -35)
states/idle/node = SubResource("AnimationNodeAnimation_xd33j")
states/idle/position = Vector2(517, 100.778)
states/ready_aim/node = SubResource("AnimationNodeAnimation_ht6xd")
states/ready_aim/position = Vector2(346.086, 250)
states/run/node = SubResource("AnimationNodeAnimation_vd2uf")
states/run/position = Vector2(671, 100.111)
transitions = ["Start", "dropin", SubResource("AnimationNodeStateMachineTransition_q6eal"), "idle", "run", SubResource("AnimationNodeStateMachineTransition_6v802"), "run", "idle", SubResource("AnimationNodeStateMachineTransition_herc0"), "howl", "idle", SubResource("AnimationNodeStateMachineTransition_jdvk7"), "dropin", "howl", SubResource("AnimationNodeStateMachineTransition_w485l"), "idle", "ready_aim", SubResource("AnimationNodeStateMachineTransition_qxgsg"), "ready_aim", "fire", SubResource("AnimationNodeStateMachineTransition_7uv1i"), "fire", "idle", SubResource("AnimationNodeStateMachineTransition_qo77p")]
graph_offset = Vector2(-124, 46)

[node name="wesley" instance=ExtResource("1_sf727")]

[node name="pawn" parent="." index="0"]
damage = 10

[node name="shape" parent="pawn" index="0"]
shape = SubResource("BoxShape3D_p0n00")

[node name="ammo" parent="pawn" index="1"]
shell_loss_amount = 30
weapon_drop_on_death = ExtResource("2_citca")
health = 20

[node name="ammo_count_label" parent="pawn/ammo" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.30067, 0)

[node name="wesley" parent="pawn" index="2" instance=ExtResource("2_4rdvv")]

[node name="Skeleton3D" parent="pawn/wesley/Armature" index="0"]
bones/1/position = Vector3(3.22583e-08, 0.914707, -0.313202)
bones/1/rotation = Quaternion(-1.2871e-07, 0.980749, 0.195273, -2.78637e-07)
bones/1/scale = Vector3(1, 1, 1)
bones/2/rotation = Quaternion(-0.0898211, -3.64509e-07, 1.24746e-08, 0.995958)
bones/3/position = Vector3(1.6508e-08, 0.997367, 0.110532)
bones/3/rotation = Quaternion(-0.00576586, 4.1584e-07, 1.64832e-09, 0.999983)
bones/3/scale = Vector3(1, 1, 1)
bones/4/position = Vector3(-0.225024, 0.119938, -0.109862)
bones/4/rotation = Quaternion(-0.374953, -1.25582e-07, 7.71514e-08, 0.927044)
bones/5/position = Vector3(0.222651, 0.329132, -0.304381)
bones/5/rotation = Quaternion(-0.179795, -2.70329e-07, 1.92427e-08, 0.983704)
bones/5/scale = Vector3(1, 1, 1)
bones/6/rotation = Quaternion(-0.992911, -1.29694e-07, -3.24916e-07, 0.118858)
bones/6/scale = Vector3(1, 1, 1)
bones/7/rotation = Quaternion(-8.73865e-09, -0.972994, 0.23083, 7.34592e-08)
bones/8/rotation = Quaternion(-0.923665, -2.08699e-07, -1.7596e-07, 0.383201)
bones/9/rotation = Quaternion(4.76719e-08, -0.906893, 0.421361, -6.84685e-08)
bones/10/rotation = Quaternion(-2.4219e-07, 0.249149, 0.968465, 7.7127e-08)
bones/10/scale = Vector3(1, 1, 1)
bones/11/position = Vector3(0.225024, 0.259996, -0.371957)
bones/11/rotation = Quaternion(-1.96811e-08, 0.396116, 0.9182, -2.99059e-08)
bones/13/position = Vector3(-0.225024, 0.259996, -0.0891952)
bones/13/rotation = Quaternion(1.18963e-07, 0.396116, 0.9182, 2.99059e-08)
bones/13/scale = Vector3(1, 1, 1)

[node name="Cube" parent="pawn/wesley/Armature/Skeleton3D" index="0"]
surface_material_override/0 = ExtResource("3_r16x8")

[node name="aim_bone" type="BoneAttachment3D" parent="pawn/wesley/Armature/Skeleton3D" index="1"]
transform = Transform3D(1, 2.86289e-07, -4.42655e-07, -5.97112e-10, 0.840302, 0.542119, 5.27166e-07, -0.542119, 0.840301, 4.55026e-08, 1.54481, 0.0519293)
bone_name = "chest"
bone_idx = 2

[node name="laser_bone" type="BoneAttachment3D" parent="pawn/wesley/Armature/Skeleton3D" index="2"]
transform = Transform3D(1, 4.64652e-07, -4.0986e-07, 2.93602e-07, 0.227147, 0.973861, 5.45604e-07, -0.973861, 0.227147, -0.225023, 1.58603, -0.105408)
bone_name = "canister"
bone_idx = 4

[node name="mesh_instance_3d" type="MeshInstance3D" parent="pawn/wesley/Armature/Skeleton3D/laser_bone" index="0"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 25, 0)
visible = false
ignore_occlusion_culling = true
mesh = SubResource("QuadMesh_bdlb5")
surface_material_override/0 = SubResource("StandardMaterial3D_lbsu1")

[node name="weapon_bone" type="BoneAttachment3D" parent="pawn/wesley/Armature/Skeleton3D" index="3"]
transform = Transform3D(1, 4.8371e-07, -8.51533e-07, 3.97472e-07, 0.594209, 0.80431, 8.95042e-07, -0.80431, 0.594209, 0.222652, 1.65637, -0.382272)
bone_name = "rifle"
bone_idx = 5

[node name="weapon_config_wesley" parent="pawn/wesley/Armature/Skeleton3D/weapon_bone" index="0" node_paths=PackedStringArray("ammo") instance=ExtResource("4_05i2f")]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
ammo = NodePath("../../../../../ammo")

[node name="animation_tree" type="AnimationTree" parent="pawn/wesley" index="2"]
root_motion_track = NodePath("Armature/Skeleton3D:root")
tree_root = SubResource("AnimationNodeStateMachine_8rvsn")
advance_expression_base_node = NodePath("../../agent")
anim_player = NodePath("../AnimationPlayer")

[node name="audio_stream_player_3d" type="AudioStreamPlayer3D" parent="pawn/wesley" index="3"]
stream = ExtResource("5_af5m6")

[node name="agent" parent="pawn" index="3" node_paths=PackedStringArray("personal_target", "aim_bone", "laser_path", "weapon_config")]
target_desired_distance = 2.0
script = ExtResource("4_i2k7d")
personal_target = NodePath("../../personal_target")
aim_bone = NodePath("../wesley/Armature/Skeleton3D/aim_bone")
laser_path = NodePath("../wesley/Armature/Skeleton3D/laser_bone/mesh_instance_3d")
aim_turn_speed = 0.55
move_target_iterations = 5
weapon_config = NodePath("../wesley/Armature/Skeleton3D/weapon_bone/weapon_config_wesley")
idle_on_ready = 7.0
walk_speed = 800.0
turn_speed = 2.0

[node name="aim_giveup_timer" type="Timer" parent="pawn/agent" index="1"]
wait_time = 8.0
one_shot = true

[node name="character_root_motion" type="RootMotionView" parent="pawn" index="4"]
animation_path = NodePath("../wesley/animation_tree")
script = ExtResource("4_xrh1b")

[node name="personal_target" type="Node3D" parent="." index="1"]

[editable path="pawn"]
[editable path="pawn/ammo"]
[editable path="pawn/wesley"]
